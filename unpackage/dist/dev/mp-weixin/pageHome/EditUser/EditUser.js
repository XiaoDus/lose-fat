"use strict";const e=require("../../common/vendor.js");if(!Array){const T=e.resolveComponent("uni-notice-bar"),_=e.resolveComponent("uni-list-item"),h=e.resolveComponent("uni-list"),s=e.resolveComponent("uni-section"),f=e.resolveComponent("uni-popup-message"),m=e.resolveComponent("uni-popup-dialog");(T+_+h+s+f+m)()}const Q=()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js",R=()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js",V=()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js",X=()=>"../../uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.js",Y=()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js";Math||(Q+R+V+Z+X+Y)();const Z=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js",ee={__name:"EditUser",setup(T){const{proxy:_}=e.getCurrentInstance(),{$request:h}=e.getCurrentInstance().appContext.config.globalProperties,s=e.ref(null),f=e.ref(!1),m=e.ref(null),w=e.ref(null),M=e.ref(""),W=()=>{const t=s.value.userPhone.slice(0,3),u=s.value.userPhone.slice(-4);M.value="更换后现手机号"+t+"****"+u+"将不能用于登录！",w.value.open()},n=e.ref([]),b=e.ref(""),H=e.ref(""),E=()=>{h("/user/getUser","POST").then(t=>{if(t.code==="200"){s.value=t.data;const u=[{name:"userName",title:"用户名",value:s.value.userName},{name:"userPassword",title:"密码",value:""},{name:"userAge",title:"年龄",value:s.value.userAge},{name:"userSex",title:"性别",value:s.value.userSex},{name:"userBirthday",title:"生日",value:s.value.userBirthday},{name:"userPhone",title:"关联手机",value:s.value.userPhone},{name:"userHeight",title:"身高(单位:cm)",value:s.value.userHeight},{name:"userWeight",title:"体重(单位:斤)",value:s.value.userWeight},{name:"standardWeigth",title:"标准体重(单位:斤)",value:s.value.standardWeigth},{name:"basalMetabolism",title:"基础代谢(单位:千卡)",value:s.value.basalMetabolism}];n.value=u,H.value=s.value.token,b.value=s.value.avatar!=null?s.value.avatar:_.$host+"/file/download/avatar.png"}})};e.onLoad(()=>{E()});const $=()=>{e.index.navigateTo({url:"../../pageHome/UpdataPhone/UpdataPhone"}),w.value.close()},j=()=>{w.value.close()},P=e.ref(""),v=e.reactive({oldPwd:"",newPwd:""}),c=e.ref("success"),p=e.ref(""),d=e.ref(null),F=t=>{f.value=t,m.value.open()},L=()=>{f.value?h("/user/updateUserPwd","POST",v).then(t=>{t.code=="200"?(c.value="success",p.value="修改成功！",d.value.open(),m.value.close(),v.newPwd="",v.oldPwd=""):(c.value="error",p.value=t.message,d.value.open())}):h("/user/updateUserName?editUserName="+P.value,"POST").then(t=>{t.code=="200"?(e.index.setStorageSync("user",t.data),n.value.filter(u=>{u.title==="用户名"&&(u.value=t.data.userName)}),c.value="success",p.value="修改成功！",d.value.open(),m.value.close(),P.value=""):(c.value="error",p.value=t.message,d.value.open())})},B=e.ref(["男","女"]),y=(()=>{let t=[];for(let u=100;u<=220;u++)t.push(u+" cm");return t})(),A=(()=>{let t=[];for(let u=80;u<=300;u++)t.push(u+" 斤");return t})(),N=(()=>{const t=[];for(let u=1;u<=100;u++)t.push(u);return t})(),g=(t,u)=>{n.value.forEach(a=>{a.title===t&&(t=="性别"?a.value=B.value[u.detail.value]:t=="年龄"?a.value=1+parseInt(u.detail.value):t=="身高(单位:cm)"?a.value=y[u.detail.value]:t=="体重(单位:斤)"?a.value=A[u.detail.value]:t=="标准体重(单位:斤)"?a.value=u.detail.standardWeight:t=="基础代谢(单位:千卡)"?a.value=u.detail.basaMetabolism:a.value=u.detail.value)})},D=t=>{g("生日",t)},O=t=>{g("性别",t),U(t),x(t)},k=t=>{g("年龄",t),x(t)},q=t=>{g("身高(单位:cm)",t),U(t),x(t)},I=t=>{g("体重(单位:斤)",t),x(t)},U=t=>{const a=n.value.filter(i=>i.title=="身高(单位:cm)"?i:null)[0].value.slice(0,-3),o=n.value.filter(i=>i.title=="性别"?i:null);let l=null;o[0].value=="男"?l=Math.round((a-80)*.7)*2+" 斤":l=Math.round((a-70)*.6)*2+" 斤",t.detail.standardWeight=l,g("标准体重(单位:斤)",t)},x=t=>{const u=n.value.filter(r=>r.title=="身高(单位:cm)"?r:null),a=n.value.filter(r=>r.title=="体重(单位:斤)"?r:null),o=n.value.filter(r=>r.title=="年龄"?r:null),l=u[0].value.slice(0,-3),i=o[0].value,C=a[0].value.slice(0,-2),K=n.value.filter(r=>r.title=="性别"?r:null);let S=null;K[0].value=="男"?S=Math.round(10*C/2+6.25*l-5*i+5)+" 千卡":S=Math.round(10*C/2+6.25*l-5*i-161)+" 千卡",t.detail.basaMetabolism=S,g("基础代谢(单位:千卡)",t)},z=()=>{e.index.chooseMedia({count:1,mediaType:["image"],sourceType:["album"],success:t=>{e.index.uploadFile({url:_.$host+"/file/upload",filePath:t.tempFiles[0].tempFilePath,fileType:"image",name:"file",header:{Authorization:e.index.getStorageSync("token")},success:u=>{if(u.statusCode===200){const a=e.index.getStorageSync("user");a.avatar=u.data,e.index.setStorageSync("user",a),b.value=u.data}else c.value="error",p.value=u.message,d.value.open()}})}})},G=()=>{const t={userName:"string",userPhone:"string",userAge:0,userBirthday:"2024-03-26",userHeight:"string",userWeight:"string",standardWeigth:"string",basalMetabolism:"string",userSex:"string"};n.value.filter(u=>{t[u.name]=u.value?u.value:""}),delete t.userPassword,h("/user/saveUpdate","POST",t).then(u=>{u.code==="200"?(c.value="success",p.value="保存成功！",d.value.open(),e.index.setStorageSync("user",u.data)):(c.value="error",p.value=u.message,d.value.open()),console.log(u)})},J=()=>{e.index.clearStorageSync(),n.value.filter(t=>{t.value=""}),e.index.navigateBack()};return(t,u)=>e.e({a:e.p({["show-icon"]:!0,text:"新用户默认密码为用户名前8位,请及时修改密码!"}),b:`${t.$host}${b.value}`,c:e.p({showArrow:!0}),d:e.o(z),e:e.f(n.value,(a,o,l)=>e.e({a:a.title=="生日"},a.title=="生日"?{b:"254ad382-4-"+l+",254ad382-2",c:e.p({showArrow:!0,title:a.title,rightText:a.value}),d:a.value,e:e.o(D,o)}:a.title=="性别"?{g:"254ad382-5-"+l+",254ad382-2",h:e.p({showArrow:!0,title:a.title,rightText:a.value}),i:B.value,j:a.value,k:e.o(O,o)}:a.title=="年龄"?{m:"254ad382-6-"+l+",254ad382-2",n:e.p({showArrow:!0,title:a.title,rightText:a.value}),o:e.unref(N),p:a.value-1,q:e.o(k,o)}:a.title=="身高(单位:cm)"?{s:"254ad382-7-"+l+",254ad382-2",t:e.p({showArrow:!0,title:a.title,rightText:a.value}),v:e.unref(y),w:e.unref(y)[a.value],x:e.o(q,o)}:a.title=="体重(单位:斤)"?{z:"254ad382-8-"+l+",254ad382-2",A:e.p({showArrow:!0,title:a.title,rightText:a.value}),B:e.unref(A),C:e.unref(A)[a.value],D:e.o(I,o)}:a.title=="用户名"?{F:"254ad382-9-"+l+",254ad382-2",G:e.p({showArrow:!0,title:a.title,rightText:a.value}),H:e.o(i=>F(!1),o)}:a.title=="密码"?{J:"254ad382-10-"+l+",254ad382-2",K:e.p({showArrow:!0,title:a.title,rightText:"******"}),L:e.o(i=>F(!0),o)}:a.title=="关联手机"?{N:"254ad382-11-"+l+",254ad382-2",O:e.p({showArrow:!0,title:a.title,rightText:a.value}),P:e.o(i=>W(),o)}:{Q:"254ad382-12-"+l+",254ad382-2",R:e.p({showArrow:!0,title:a.title,rightText:a.value})},{f:a.title=="性别",l:a.title=="年龄",r:a.title=="身高(单位:cm)",y:a.title=="体重(单位:斤)",E:a.title=="用户名",I:a.title=="密码",M:a.title=="关联手机",S:o})),f:e.p({border:!0}),g:e.p({type:"line"}),h:e.o(G),i:e.o(J),j:f.value},f.value?{k:v.oldPwd,l:e.o(a=>v.oldPwd=a.detail.value),m:v.newPwd,n:e.o(a=>v.newPwd=a.detail.value)}:{o:P.value,p:e.o(a=>P.value=a.detail.value)},{q:e.o(L),r:e.sr(m,"254ad382-13",{k:"popup"}),s:e.p({type:"bottom",["background-color"]:"#fff",["border-radius"]:"10px 10px 0 0"}),t:e.p({type:c.value,message:p.value,duration:2e3}),v:e.sr(d,"254ad382-14",{k:"message"}),w:e.p({type:"message"}),x:e.o(j),y:e.o($),z:e.p({mode:"base",message:"确认更换手机号？",content:M.value,confirmText:"确认更换",cancelText:"我再想想",duration:2e3,["before-close"]:!0}),A:e.sr(w,"254ad382-16",{k:"popup_phone"}),B:e.p({type:"dialog"})})}},te=e._export_sfc(ee,[["__file","/Users/xiaodu/前端/LoseFat/pageHome/EditUser/EditUser.nvue"]]);wx.createPage(te);
