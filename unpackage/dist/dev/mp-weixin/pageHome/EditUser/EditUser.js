"use strict";const e=require("../../common/vendor.js");Array||e.resolveComponent("uni-calendar")();const _=()=>"../../uni_modules/uni-calendar/components/uni-calendar/uni-calendar.js";Math||_();const S=e.defineComponent({__name:"EditUser",setup(v){const{proxy:u}=e.getCurrentInstance(),{$request:l}=e.getCurrentInstance().appContext.config.globalProperties,a=e.ref(null),h=async()=>{const t=await l("/user/getUser","POST");t.code==="200"&&(a.value=t.data)},i=t=>{a.value.userSex=t,d(),r()},c=e.ref(null),m=()=>{c.value.open()},p=t=>{const n=t.fulldate,s=f();if(Date.parse(n)>=Date.parse(s)){e.index.showToast({icon:"none",title:"生日不能晚于今天"});return}a.value.userBirthday=n;const o=new Date(s),g=new Date(n);a.value.userAge=o.getFullYear()-g.getFullYear(),o.getTime()>=g.getTime()&&a.value.userAge++,r()},f=()=>{let t=new Date,n=t.getFullYear(),s=t.getMonth()+1,o=t.getDate();return s<10&&(s=`0${s}`),o<10&&(o=`0${o}`),`${n}-${s}-${o}`},d=async()=>{r(),console.log(a.value.userHeight);const t=Number.parseFloat(a.value.userHeight);let n;a.value.userSex==="男"?n=Math.round((t-80)*.7)*2:n=Math.round((t-70)*.6)*2,a.value.standardWeigth=n>=0?n+" 斤":"0"},r=async()=>{const t=a.value.userAge,n=Number.parseFloat(a.value.userHeight),s=Number.parseFloat(a.value.userWeight);let o;a.value.userSex==="男"?o=Math.round(10*s/2+6.25*n-5*t+5):o=Math.round(10*s/2+6.25*n-5*t-161),a.value.basalMetabolism=o>=0?o+" 千卡":"0 千卡"},x=()=>{e.index.chooseMedia({count:1,mediaType:["image"],sourceType:["album"],success:t=>{e.index.uploadFile({url:u.$host+"/file/upload",filePath:t.tempFiles[0].tempFilePath,fileType:"image",name:"file",header:{Authorization:e.index.getStorageSync("token")},success:n=>{if(n.statusCode===200){const s=e.index.getStorageSync("user");s.avatar=n.data,e.index.setStorageSync("user",s),a.value.avatar=n.data}else e.index.showToast({icon:"error",title:"上传失败"})}})}})},y=async()=>{const t=await l("/user/saveUpdate","POST",a.value);t.code==="200"?e.index.showToast({icon:"success",title:"修改成功"}):e.index.showToast({icon:"error",title:t.message})};return e.onLoad(()=>{h()}),(t,n)=>({a:e.s(a.value.avatar?"":"padding: 10px;"),b:a.value.avatar?e.unref(u).$host+a.value.avatar:e.unref(u).$host+"/file/download/defaultAvatar.png",c:e.o(x),d:a.value.userName,e:e.o(s=>a.value.userName=s.detail.value),f:e.o(s=>i("男")),g:e.n(a.value.userSex=="男"?"sex-select-boy":""),h:e.o(s=>i("女")),i:e.n(a.value.userSex=="女"?"sex-select-girl":""),j:e.t(a.value.userBirthday),k:e.o(m),l:e.sr(c,"254ad382-0",{k:"calendar"}),m:e.o(p),n:e.p({date:a.value.userBirthday,lunar:!0,insert:!1}),o:e.o(d),p:a.value.userHeight,q:e.o(s=>a.value.userHeight=s.detail.value),r:e.o(r),s:a.value.userWeight,t:e.o(s=>a.value.userWeight=s.detail.value),v:e.t(a.value.basalMetabolism),w:e.t(a.value.standardWeigth),x:e.o(y)})}}),b=e._export_sfc(S,[["__file","/Users/xiaodu/前端/LoseFat/pageHome/EditUser/EditUser.nvue"]]);wx.createPage(b);
