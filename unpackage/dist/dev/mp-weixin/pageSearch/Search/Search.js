"use strict";const e=require("../../common/vendor.js");if(!Array){const m=e.resolveComponent("uni-icons"),l=e.resolveComponent("uni-easyinput"),f=e.resolveComponent("uni-list-item");(m+l+f)()}const x=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",b=()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js",k=()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js";Math||(x+b+k)();const F=e.defineComponent({__name:"Search",setup(m){const{$request:l}=e.getCurrentInstance().appContext.config.globalProperties,f=e.reactive({1:"#70c995",2:"#f7cc4f",3:"red"}),c=e.ref([]);e.onLoad(a=>{const t=e.index.getStorageSync("searchStorage");g.value=a.url?a.url:"FoodMessage",t?c.value=t:(e.index.setStorage({key:"searchStorage",data:[]}),c.value=[])});const i=e.ref(""),r=e.ref([]),d=e.ref(null),s=e.ref(!1),v=()=>{d.value!=null&&clearTimeout(d.value),d.value=setTimeout(async()=>{if(clearTimeout(d.value),i.value.length>0){const a=await l("/foods/getfoodbykey?key="+i.value,"GET");a.code==="200"&&(r.value=a.data,r.value!=null?s.value=!0:s.value=!1)}},2e3)},p=async a=>{i.value=a;const t=await l("/foods/getfoodbykey?key="+a,"GET");t.code==="200"&&(r.value=t.data,r.value!=null?s.value=!0:s.value=!1)},_=()=>{r.value=[],s.value=!1},g=e.ref("FoodMessage"),y=async a=>{const t=await l("/foods/food_message?foodId="+a,"GET");if(t.code=="200"){const o=t.data;c.value.indexOf(o.name)==-1&&(c.value.push(o.name),e.index.setStorage({key:"searchStorage",data:c.value.reverse()}));const n=await l("/collect/get_collect?foodId="+a,"GET");n.code==="401"?e.index.navigateTo({url:"../../pageLogin/Login/Login"}):(o.collect=n.data,g.value==="FoodMessage"?e.index.navigateTo({url:"../FoodMessage/FoodMessage",success:u=>{e.index.$emit("foodMessage",o),i.value="",_()}}):g.value==="FoodCompare"&&e.index.navigateBack({success:()=>{e.index.$emit("getFoodmessage",o)}}))}},h=()=>{c.value=[],e.index.removeStorage({key:"searchStorage"})};return(a,t)=>e.e({a:e.o(v),b:e.p({type:"search",color:"#77b3f8",size:"30"}),c:e.o(v),d:e.o(v),e:e.o(_),f:e.o(o=>i.value=o),g:e.p({styles:"{height: 50px,border-radius: 25px,}",primaryColor:"#9c9c9c",trim:"true",inputBorder:!1,placeholder:"请输入食物名称",modelValue:i.value}),h:s.value},s.value?{i:e.f(r.value,(o,n,u)=>({a:"d2b35330-3-"+u+","+("d2b35330-2-"+u),b:e.p({type:"smallcircle-filled",size:"15",color:f[o.healthLevel]}),c:e.o(S=>y(o.foodId),n),d:"d2b35330-2-"+u,e:e.p({clickable:!0,title:o.name,note:o.calory+"千卡/100克",link:!0}),f:n}))}:{},{j:!s.value},s.value?{}:{k:e.p({type:"trash-filled",size:"18",color:"#6e6e6e;"}),l:e.o(h),m:e.f(c.value,(o,n,u)=>({a:e.t(o),b:n,c:e.o(S=>p(o),n)}))})}}),C=e._export_sfc(F,[["__file","/Users/xiaodu/前端/LoseFat/pageSearch/Search/Search.vue"]]);wx.createPage(C);
